pnpm lint-staged
pnpm knip
pnpm jscpd

# --- Rust quality checks (only when Rust files are staged) ---
RUST_CHANGED=$(git diff --cached --name-only --diff-filter=ACMR -- 'src-tauri/src/**' 'src-tauri/Cargo.toml')

if [ -n "$RUST_CHANGED" ]; then
  echo "Rust files changed — running Rust quality checks..."
  cd src-tauri

  echo "[1/4] cargo fmt --check"
  cargo fmt -- --check || { echo "FAILED: cargo fmt — run 'pnpm tauri:fmt' to fix"; exit 1; }

  echo "[2/4] cargo clippy"
  cargo clippy -- -D warnings || { echo "FAILED: cargo clippy"; exit 1; }

  echo "[3/4] cargo test"
  cargo test || { echo "FAILED: cargo test"; exit 1; }

  echo "[4/4] cargo machete"
  cargo machete || { echo "FAILED: cargo machete — unused dependencies found"; exit 1; }

  echo "All Rust checks passed."
  cd ..
fi
